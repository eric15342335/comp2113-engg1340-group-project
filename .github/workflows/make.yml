name: Make

on:
    push:
        branches:
            - main
    pull_request:
    workflow_dispatch:

concurrency:
    group: "make"
    cancel-in-progress: false

jobs:
  Make:
    runs-on: self-hosted
    timeout-minutes: 2
    #runs-on: ${{ matrix.os }}
    #strategy:
    #  fail-fast: true
    #  matrix:
    #    os: [ubuntu-latest, windows-latest]
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Make
      run: |
        make
    - name: Make test
      run: |
        echo -e "0\n saves\nsaves\nN\nY\nT\n1\nT\nX\nY\n" > input.txt
        ./stocksim < input.txt
    - name: Doxygen Documentation
      if: always()
      run: |
        make docs
    - name: Upload executable
      uses: actions/upload-artifact@v4
      with:
        # suppose we compiled our game and named it 'stocksim'
        # use wildcard to match the executable for all platforms
        name: stocksim
        # name: stocksim-${{ matrix.os }}
        path: stocksim*
        compression-level: 9
        retention-days: 90
        if-no-files-found: error
