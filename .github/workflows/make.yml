name: Make

on:
    push:
        branches:
            - main
    pull_request:
    workflow_dispatch:

jobs:
  Make:
    runs-on: self-hosted
    #runs-on: ${{ matrix.os }}
    #strategy:
    #  fail-fast: true
    #  matrix:
    #    os: [ubuntu-latest, windows-latest]
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Make
      run: |
        make
    - name: Make test
      run: |
        make test
    - name: Doxygen Documentation
      if: always()
      run: |
        doxygen Doxyfile
    - name: Upload executable
      if: always()
      uses: actions/upload-artifact@v4
      with:
        # suppose we compiled our game and named it 'stocksim'
        # use wildcard to match the executable for all platforms
        name: stocksim
        # name: stocksim-${{ matrix.os }}
        path: stocksim*
        compression-level: 9
        retention-days: 90
        if-no-files-found: error
